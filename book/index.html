<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="theme-color" content="#0b0f14" />
  <title>My BookShelf</title>

  <link rel="stylesheet" href="./style.css" />

  <!-- QR scanner library (global Html5Qrcode) -->
  <script src="https://unpkg.com/html5-qrcode" defer></script>

  <!-- Google APIs: keep onload hooks (gapiLoaded / gisLoaded) -->
  <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
  <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>

  <!-- App entry (modules) -->
  <script type="module" src="./js/main.js"></script>
</head>

<body>
  <header>
    <div class="header-left">
      <button id="menu-btn" aria-label="Open menu" type="button">â˜°</button>
      <h1 class="app-title">
        ðŸ“š <span class="title-my">My</span> <span class="title-main">BookShelf</span>
      </h1>
    </div>

    <div class="header-right">
      <button id="auth-btn" class="header-auth-btn" type="button" disabled>Sign In</button>
      <div id="sync-wrapper" aria-hidden="true">
        <div id="sync-dot" title="Sync Status"></div>
      </div>
    </div>
  </header>

  <!-- Overlay -->
  <div id="menu-overlay" aria-hidden="true"></div>

  <!-- Side menu -->
  <aside id="side-menu" aria-label="Side menu">
    <h2 class="menu-title" id="menu-settings" style="margin-top:0;">Settings & Filters</h2>

    <!-- Language -->
    <section class="menu-section" aria-label="Language">
      <span class="menu-title" id="menu-lang" style="font-size:0.9rem;">Language</span>
      <select id="language-select" class="menu-select" aria-label="Language">
        <option value="en">English ðŸ‡¬ðŸ‡§</option>
        <option value="fi">Suomi ðŸ‡«ðŸ‡®</option>
        <option value="et">Eesti ðŸ‡ªðŸ‡ª</option>
      </select>
    </section>

    <!-- Shelves / Stats -->
    <section class="menu-section" aria-label="Shelves">
      <span class="menu-title" id="menu-shelves">Shelves</span>
      <div class="shelf-counters" role="group" aria-label="Shelf counters">
        <div class="stat-box">
          <span class="stat-label" id="label-stat-read">Read</span>
          <span id="count-read" class="stat-num">0</span>
        </div>
        <div class="stat-box">
          <span class="stat-label" id="label-stat-wish">Wishlist</span>
          <span id="count-wishlist" class="stat-num">0</span>
        </div>
        <div class="stat-box">
          <span class="stat-label" id="label-stat-loans">Loans</span>
          <span id="count-loans" class="stat-num">0</span>
        </div>
      </div>
    </section>

    <!-- Display -->
    <section class="menu-section" aria-label="Display">
      <label class="menu-title" id="menu-display">Display</label>
      <div class="menu-row">
        <span id="label-darkmode">Dark Mode</span>
        <label class="toggle-switch" aria-label="Toggle dark mode">
          <input type="checkbox" id="dark-mode-toggle" />
          <span class="slider"></span>
        </label>
      </div>
    </section>

    <!-- Filters -->
    <section class="menu-section" aria-label="Filters">
      <label class="menu-title" id="menu-filter">Filter Books</label>

      <input
        type="text"
        id="filter-text"
        class="menu-input"
        placeholder="Title, Author, or ISBN"
        autocomplete="off"
        spellcheck="false"
      />

      <div class="filter-grid">
        <div class="filter-field">
          <label for="filter-year" id="label-year">Year</label>
          <input
            type="text"
            id="filter-year"
            class="menu-input"
            placeholder="YYYY"
            inputmode="numeric"
            maxlength="4"
            autocomplete="off"
          />
        </div>

        <div class="filter-field">
          <label for="filter-month" id="label-month">Month</label>
          <select id="filter-month" class="menu-select" aria-label="Month">
            <option value="">All</option>
            <option value="01">01</option><option value="02">02</option><option value="03">03</option>
            <option value="04">04</option><option value="05">05</option><option value="06">06</option>
            <option value="07">07</option><option value="08">08</option><option value="09">09</option>
            <option value="10">10</option><option value="11">11</option><option value="12">12</option>
          </select>
        </div>
      </div>

      <div class="menu-row" style="margin-top:12px;">
        <span id="label-rating">Rating</span>
        <select id="filter-rating" class="menu-select" aria-label="Rating" style="width:60%;">
          <option value="">All</option>
          <option value="5">5 â˜…</option>
          <option value="4">4 â˜…</option>
          <option value="3">3 â˜…</option>
          <option value="2">2 â˜…</option>
          <option value="1">1 â˜…</option>
        </select>
      </div>

      <div class="menu-actions">
        <button class="btn-sm" id="btn-clear-filters" type="button" style="width:100%;">Clear Filters</button>
      </div>
    </section>

    <!-- Data & Backup -->
    <section class="menu-section" aria-label="Data and backup" style="border-bottom:none; margin-top:auto;">
      <label class="menu-title" id="menu-data">Data & Backup</label>

      <!-- Cloud sync buttons injected by JS -->
      <div id="cloud-controls"></div>

      <button
        id="btn-export"
        class="btn-sm"
        type="button"
        style="width:100%; margin-bottom:10px; border:1px solid var(--accent); color:var(--accent); font-weight:600;"
      >
        Download Backup (JSON)
      </button>

      <input type="file" id="import-file" accept=".json" hidden />
      <button
        id="btn-import"
        class="btn-sm"
        type="button"
        style="width:100%; margin-bottom:20px; border:1px solid var(--primary); color:var(--primary);"
      >
        Restore Backup
      </button>

      <!-- Future: Goodreads import -->
      <!-- <button id="btn-import-goodreads" class="btn-sm" type="button" style="width:100%; margin-bottom:10px;">Import Goodreads CSV</button> -->

      <button id="reset-btn" class="btn-sm btn-del" type="button" style="width:100%;">Reset App Data</button>
    </section>
  </aside>

  <!-- Toast / debug -->
  <div id="debug-log" role="status" aria-live="polite" aria-atomic="true"></div>

  <!-- Tabs -->
  <nav class="tabs" aria-label="Shelves tabs">
    <div class="tab active" id="tab-read" role="button" tabindex="0">Read</div>
    <div class="tab" id="tab-wishlist" role="button" tabindex="0">Wishlist</div>
    <div class="tab" id="tab-loans" role="button" tabindex="0">Loans</div>
  </nav>

  <!-- Controls -->
  <main>
    <section class="controls" aria-label="Add books">
      <input
        type="text"
        id="isbn-input"
        placeholder="..."
        autocomplete="off"
        spellcheck="false"
        inputmode="search"
      />
      <button class="action-btn" id="btn-add" type="button">Add</button>
      <button class="action-btn scan-btn" id="btn-scan" type="button" aria-label="Scan ISBN">ðŸ“·</button>
    </section>

    <!-- Camera reader -->
    <section id="reader-container" aria-label="Camera scanner">
      <div id="reader"></div>
      <button
        id="btn-stop-camera"
        type="button"
        style="width:100%; padding:10px; margin-top:10px; background:var(--card); border:1px solid var(--border); border-radius:4px; color:var(--text); font-weight:500;"
      >
        Stop Camera
      </button>
    </section>

    <!-- Filter status bar (injected by render.js logic) -->
    <div id="filter-status" style="display:none;"></div>

    <!-- Book list -->
    <ul id="book-list" aria-label="Books"></ul>
  </main>

  <!-- Footer -->
  <footer class="app-footer">
    Created by <strong>eZabber</strong> &copy; <span id="year"></span>
  </footer>

  <!-- Modal -->
  <div id="modal-overlay" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-label="Add book">
      <img id="modal-img" class="modal-cover" src="" alt="cover" onerror="this.style.display='none'" />
      <div id="modal-title" class="modal-title"></div>
      <div id="modal-author" class="modal-author"></div>
      <div id="modal-isbn" style="font-size:0.8rem; color:var(--meta); margin-bottom:10px; font-family:monospace;"></div>

      <div class="modal-input-row" style="justify-content:center; gap:10px;">
        <span id="label-audio">ðŸŽ§ Audio?</span>
        <label class="toggle-switch" aria-label="Toggle audio book">
          <input type="checkbox" id="modal-audio-check" />
          <span class="slider"></span>
        </label>
      </div>

      <div id="loan-date-row" class="modal-input-row" style="display:none; justify-content:center; gap:10px;">
        <span id="label-return">ðŸ“… Return</span>
        <input
          type="date"
          id="modal-return-date"
          style="padding:6px; border-radius:6px; border:1px solid var(--border); background:var(--card); color:var(--text);"
        />
      </div>

      <div class="modal-btns">
        <button class="btn-choice btn-primary" id="modal-add-read" type="button">Add to Read</button>
        <button class="btn-choice btn-primary" id="modal-add-wish" type="button" style="background:var(--accent);">Add to Wishlist</button>
        <button class="btn-choice btn-loan" id="modal-add-loan" type="button">Add to Loans</button>
        <button class="btn-choice btn-cancel" id="modal-cancel" type="button">Cancel</button>
      </div>
    </div>
  </div>
</body>
</html>

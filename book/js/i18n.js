export const translations = {
    en: {
        'app.title': 'MyBookShelf',
        'nav.add': 'Add Book',
        'nav.library': 'Library',
        'nav.reading': 'Read',
        'nav.future': 'To Read',
        'nav.wishlist': 'Wishlist',
        'nav.loans': 'Loans',
        'nav.mode': 'Dark Mode',
        'nav.mode_light': 'Light Mode',
        'nav.mode_dark': 'Dark Mode',
        'scan.btn': 'Scan ISBN',
        'nav.mode_light': 'Light Mode',
        'nav.mode_dark': 'Dark Mode',
        'scan.btn': 'Scan ISBN',
        'scan.found': 'ISBN Found',
        'search.placeholder': 'Enter ISBN...',
        'form.title': 'Title',
        'form.author': 'Author',
        'form.save': 'Save Book',
        'filter.title': 'Filter by Title...',
        'filter.author': 'Filter by Author...',
        'filter.keyword': 'Filter by Keyword...',
        'filter.year': 'Pub. Year',
        'filter.readYear': 'Read Year',
        'filter.rating': 'All Ratings',
        'filter.month': 'All Months',
        'filter.language': 'Language',
        'filter.clear': 'Clear Filters',
        'filter.sort': 'Sort',
        'sort.newest': 'Recently Added',
        'sort.az': 'Title (A-Z)',
        'sort.za': 'Title (Z-A)',
        'sort.author_az': 'Author (A-Z)',
        'sort.author_za': 'Author (Z-A)',
        'sort.rating_hl': 'Rating (High-Low)',
        'stats.read': 'Read',
        'stats.wishlist': 'Wishlist',
        'stats.loan': 'Loan',
        'month.0': 'January', 'month.1': 'February', 'month.2': 'March', 'month.3': 'April',
        'month.4': 'May', 'month.5': 'June', 'month.6': 'July', 'month.7': 'August',
        'month.8': 'September', 'month.9': 'October', 'month.10': 'November', 'month.11': 'December',
        'btn.import': 'Import Goodreads CSV',
        'btn.export': 'Export CSV',
        'btn.delete': 'Delete All Data',
        'menu.stats': 'Library Stats',
        'menu.stats': 'Library Stats',
        'menu.filters': 'Filters',
        'filter.clear': 'Clear Filters',
        'msg.saved': 'Saved!',
        'msg.welcome': 'Welcome',
        'card.own_yes': 'Own: Yes',
        'card.own_yes': 'Own: Yes',
        'card.own_no': 'Own: No',
        'loan.type': 'Loan Type',
        'loan.borrowed': 'Borrowed',
        'loan.loaned_out': 'Loaned Out',
        'loan.borrowed_from': 'Borrowed From',
        'loan.loaned_to': 'Loaned To',
        'loan.return_date': 'Return Date',
        'loan.date_loaned': 'Loaned Out Date',
        'loan.source.library': 'Library',
        'loan.source.friend': 'Friend',
        'loan.source.work': 'Work',
        'loan.source.school': 'School',
        'loan.source.other': 'Other',
        'loan.name_placeholder': 'Name...',
        'form.status': 'Status',
        'form.audiobook': 'Audiobook',
        'form.own_book': 'Own',
        'form.cover': 'Cover',
        'form.notes': 'Notes',
        'form.rating': 'Rating',
        'form.no_rating': 'No Rating',
        'form.date_read': 'Date Read',
        'btn.event': 'Event ↗',
        'btn.cancel': 'Cancel',
        'btn.save': 'Save',
        'modal.edit_title': 'Edit Book',
        'modal.save_title': 'Save Book',
        'modal.tab_details': 'Details',
        'btn.edit_card': 'Edit',
        'btn.mark_read': 'Mark Read',
        'btn.mark_unread': 'Mark Unread',
        'btn.bin': 'Bin',
        'badge.audio': 'Audio',
        'badge.wish': 'Wish',
        'badge.toread': 'To Read',
        'form.rate_placeholder': 'Rate...',
        'manual.title': 'User Manual',
        'manual.intro.title': 'Introduction',
        'manual.intro.body': 'MyBookShelf represents a modern way to manage your personal library. It works offline first, saving data to your device, and syncs to your personal Google Drive for backup and cross-device access.',
        'manual.privacy.title': 'Data & Privacy',
        'manual.privacy.body': 'Your data belongs to you. We store your books in "Local Storage" on this browser. When you sign in, we save a backup file (mybookshelf.json) to a private invisible folder in your Google Drive (AppData). We cannot see, access, or sell your data.',
        'manual.permissions.title': 'Permissions',
        'manual.permissions.body': 'The app asks for "drive.appdata" permission. This is the minimum permission required to save one specific file to your Drive. We do not have access to your other files, photos, or documents.',
        'manual.add.title': 'Adding Books',
        'manual.add.body': 'Click the "Add" button to add books. You can Scan a Barcode (requires camera), Search by ISBN/Title (uses Google Books, OpenLibrary, Finna), or enter details Manually.',
        'manual.loans.title': 'Loans & Calendar',
        'manual.loans.body': 'Track whom you lent books to ("Loaned Out") or borrowed from ("Borrowed"). Set a "Return Date" (or "Loaned Out Date") and click "Event" to create a Google Calendar reminder.',
        'manual.filters.title': 'Filtering & Sorting',
        'manual.filters.body': 'Use the top bar to specific find books. Type a keyword, or select a Year/Rating/Month. Sort by "Date Added", "Year", or "Rating". Click "Clear Filters" or the filter reset button to show all books.',
        'nav.manual': 'User Manual',
        'btn.close': 'Close',
    },
    fi: {
        'app.title': 'Kirjahyllyni',
        'nav.add': 'Lisää Kirja',
        'nav.library': 'Kirjasto',
        'nav.reading': 'Luettu',
        'nav.future': 'Tulossa',
        'nav.wishlist': 'Toivelista',
        'nav.loans': 'Lainat',
        'nav.mode': 'Tumma tila',
        'nav.mode_light': 'Vaalea tila',
        'nav.mode_dark': 'Tumma tila',
        'scan.btn': 'Skannaa ISBN',
        'scan.found': 'ISBN Löytyi',
        'search.placeholder': 'Syötä ISBN...',
        'form.title': 'Otsikko',
        'form.author': 'Kirjailija',
        'form.save': 'Tallenna',
        'filter.title': 'Suodata otsikolla...',
        'filter.author': 'Suodata kirjailijalla...',
        'filter.keyword': 'Suodata avainsanalla...',
        'filter.year': 'Julk. Vuosi',
        'filter.readYear': 'Luettu Vuonna',
        'filter.rating': 'Kaikki Arviot',
        'filter.month': 'Kaikki Kuukaudet',
        'filter.language': 'Kieli',
        'filter.clear': 'Tyhjennä Suodattimet',
        'filter.sort': 'Järjestä',
        'sort.newest': 'Viimeksi Lisätty',
        'sort.az': 'Otsikko (A-Ö)',
        'sort.za': 'Otsikko (Ö-A)',
        'sort.author_az': 'Kirjailija (A-Ö)',
        'sort.author_za': 'Kirjailija (Ö-A)',
        'sort.rating_hl': 'Arvio (Korkein)',
        'stats.read': 'Luettu',
        'stats.wishlist': 'Toivelista',
        'stats.loan': 'Lainassa',
        'month.0': 'Tammikuu', 'month.1': 'Helmikuu', 'month.2': 'Maaliskuu', 'month.3': 'Huhtikuu',
        'month.4': 'Toukokuu', 'month.5': 'Kesäkuu', 'month.6': 'Heinäkuu', 'month.7': 'Elokuu',
        'month.8': 'Syyskuu', 'month.9': 'Lokakuu', 'month.10': 'Marraskuu', 'month.11': 'Joulukuu',
        'btn.import': 'Tuo Goodreads CSV',
        'btn.export': 'Vie CSV',
        'btn.delete': 'Poista Kaikki Tiedot',
        'menu.stats': 'Kirjaston Tilastot',
        'menu.filters': 'Suodattimet',
        'msg.saved': 'Tallennettu!',
        'msg.welcome': 'Tervetuloa',
        'card.own_yes': 'Omistettu: Kyllä',
        'card.own_yes': 'Omistettu: Kyllä',
        'card.own_no': 'Omistettu: Ei',
        'loan.type': 'Lainatyyppi',
        'loan.borrowed': 'Lainattu Itselle',
        'loan.loaned_out': 'Lainattu Muille',
        'loan.borrowed_from': 'Lainaaja',
        'loan.loaned_to': 'Lainattu Henkilölle',
        'loan.return_date': 'Palautuspäivä',
        'loan.date_loaned': 'Lainauspäivä',
        'loan.source.library': 'Kirjasto',
        'loan.source.friend': 'Ystävä',
        'loan.source.work': 'Työ',
        'loan.source.school': 'Koulu',
        'loan.source.other': 'Muu',
        'loan.name_placeholder': 'Nimi...',
        'form.status': 'Tila',
        'form.audiobook': 'Äänikirja',
        'form.own_book': 'Oma',
        'form.cover': 'Kansi',
        'form.notes': 'Muistiinpanot',
        'form.rating': 'Arvio',
        'form.no_rating': 'Ei arviota',
        'form.date_read': 'Luettu Pvm',
        'btn.event': 'Tapahtuma ↗',
        'btn.cancel': 'Peruuta',
        'btn.save': 'Tallenna',
        'modal.edit_title': 'Muokkaa Kirjaa',
        'modal.save_title': 'Tallenna Kirja',
        'modal.tab_details': 'Tiedot',
        'btn.edit_card': 'Muokkaa',
        'btn.mark_read': 'Merkitse Luetuksi',
        'btn.mark_unread': 'Merkitse Lukemattomaksi',
        'btn.bin': 'Poista',
        'badge.audio': 'Ääni',
        'badge.wish': 'Toive',
        'badge.toread': 'Luettava',
        'form.rate_placeholder': 'Arvioi...',
        'manual.title': 'Käyttöohje',
        'manual.intro.title': 'Johdanto',
        'manual.intro.body': 'MyBookShelf on moderni tapa hallita omaa kirjastoasi. Se toimii ensisijaisesti offline-tilassa tallentaen tiedot laitteellesi ja synkronoi ne Google Driveen varmuuskopiointia varten.',
        'manual.privacy.title': 'Tietosuoja',
        'manual.privacy.body': 'Tietosi ovat sinun. Tallennamme kirjasi selaimesi muistiin. Kirjautuessasi tallennamme varmuuskopion (mybookshelf.json) yksityiseen kansioon Google Drivessasi. Meillä ei ole pääsyä tietoihisi.',
        'manual.permissions.title': 'Käyttöoikeudet',
        'manual.permissions.body': 'Sovellus pyytää "drive.appdata"-oikeutta. Tämä on pienin mahdollinen oikeus, joka tarvitaan yhden tiedoston tallentamiseen Driveen. Emme pääse käsiksi muihin tiedostoihisi.',
        'manual.add.title': 'Kirjojen Lisääminen',
        'manual.add.body': 'Napsauta "Lisää" -painiketta lisätäksesi kirjoja. Voit skannata viivakoodin, hakea nimellä/ISBN:llä (Google Books, OpenLibrary, Finna) tai syöttää tiedot käsin.',
        'manual.loans.title': 'Lainat & Kalenteri',
        'manual.loans.body': 'Seuraa lainattuja ("Lainattu ulos") tai lainassa olevia ("Lainattu") kirjoja. Aseta päivämäärä ja luo kalenterimuistutus "Tapahtuma"-linkistä.',
        'manual.filters.title': 'Suodatus & Lajittelu',
        'manual.filters.body': 'Käytä yläpalkkia kirjojen etsimiseen. Suodata vuoden, arvosanan tai kuukauden mukaan. Lajittele lisäyspäivän, vuoden tai arvosanan mukaan.',
        'nav.manual': 'Käyttöohje',
        'btn.close': 'Sulje',
    },
    et: {
        'app.title': 'Minu Raamaturiiul',
        'nav.add': 'Lisa Raamat',
        'nav.library': 'Raamatukogu',
        'nav.reading': 'Loetud',
        'nav.future': 'Lugemisel',
        'nav.wishlist': 'Soovileht',
        'nav.loans': 'Laenud',
        'nav.mode': 'Tume režiim',
        'nav.mode_light': 'Hele režiim',
        'nav.mode_dark': 'Tume režiim',
        'scan.btn': 'Skänni ISBN',
        'scan.found': 'ISBN Leitud',
        'search.placeholder': 'Sisesta ISBN...',
        'form.title': 'Pealkiri',
        'form.author': 'Autor',
        'form.save': 'Salvesta',
        'filter.title': 'Filtreeri pealkirjaga...',
        'filter.author': 'Filtreeri autoriga...',
        'filter.keyword': 'Filtreeri märksõnaga...',
        'filter.year': 'Ilmumisaasta',
        'filter.readYear': 'Loetud Aastal',
        'filter.rating': 'Kõik Hinnangud',
        'filter.month': 'Kõik Kuud',
        'filter.language': 'Keel',
        'filter.clear': 'Tühjenda Filtrid',
        'filter.sort': 'Sorteeri',
        'sort.newest': 'Hiljuti Lisatud',
        'sort.az': 'Pealkiri (A-Ü)',
        'sort.za': 'Pealkiri (Ü-A)',
        'sort.author_az': 'Autor (A-Ü)',
        'sort.author_za': 'Autor (Ü-A)',
        'sort.rating_hl': 'Hinnang (Kõrgeim)',
        'stats.read': 'Loetud',
        'stats.wishlist': 'Soovileht',
        'stats.loan': 'Laenud',
        'month.0': 'Jaanuar', 'month.1': 'Veebruar', 'month.2': 'Märts', 'month.3': 'Aprill',
        'month.4': 'Mai', 'month.5': 'Juuni', 'month.6': 'Juuli', 'month.7': 'August',
        'month.8': 'September', 'month.9': 'Oktoober', 'month.10': 'November', 'month.11': 'Detsember',
        'btn.import': 'Impordi Goodreads CSV',
        'btn.export': 'Ekspordi CSV',
        'btn.delete': 'Kustuta Kõik Andmed',
        'menu.stats': 'Raamatukogu Statistika',
        'menu.filters': 'Filtrid',
        'msg.saved': 'Salvestatud!',
        'msg.welcome': 'Tere tulemast',
        'card.own_yes': 'Oman: Jah',
        'card.own_yes': 'Oman: Jah',
        'card.own_no': 'Oman: Ei',
        'loan.type': 'Laenu Tüüp',
        'loan.borrowed': 'Laenatud',
        'loan.loaned_out': 'Välja Laenatud',
        'loan.borrowed_from': 'Laenaja',
        'loan.loaned_to': 'Laenatud Kellele',
        'loan.return_date': 'Tagastamise Kuupäev',
        'loan.date_loaned': 'Laenamise kuupäev',
        'loan.source.library': 'Raamatukogu',
        'loan.source.friend': 'Sõber',
        'loan.source.work': 'Töö',
        'loan.source.school': 'Kool',
        'loan.source.other': 'Muu',
        'loan.name_placeholder': 'Nimi...',
        'form.status': 'Olek',
        'form.audiobook': 'Heliraamat',
        'form.own_book': 'Oman',
        'form.cover': 'Kaas',
        'form.notes': 'Märkmed',
        'form.rating': 'Hinne',
        'form.no_rating': 'Hinne puudub',
        'form.date_read': 'Loetud Kuupäev',
        'btn.event': 'Sündmus ↗',
        'btn.cancel': 'Loobu',
        'btn.save': 'Salvesta',
        'modal.edit_title': 'Muuda Raamatut',
        'modal.save_title': 'Salvesta Raamat',
        'modal.tab_details': 'Üksikasjad',
        'btn.edit_card': 'Muuda',
        'btn.mark_read': 'Märgi Loetuks',
        'btn.mark_unread': 'Märgi Mitteloetuks',
        'btn.bin': 'Kustuta',
        'badge.audio': 'Heli',
        'badge.wish': 'Soovileht',
        'badge.toread': 'Lugemist Ootav',
        'form.rate_placeholder': 'Hinda...',
        'manual.title': 'Kasutusjuhend',
        'manual.intro.title': 'Sissejuhatus',
        'manual.intro.body': 'MyBookShelf on kaasaegne viis oma raamatukogu haldamiseks. See töötab võrguühenduseta, salvestades andmed seadmesse, ja sünkroonib Google Drive\'iga varundamiseks.',
        'manual.privacy.title': 'Andmed ja Privaatsus',
        'manual.privacy.body': 'Sinu andmed kuuluvad sulle. Salvestame raamatud brauseri mällu. Sisselogimisel salvestame varukoopia (mybookshelf.json) privaatsesse kausta sinu Google Drive\'is. Meil puudub ligipääs sinu andmetele.',
        'manual.permissions.title': 'Load',
        'manual.permissions.body': 'Rakendus küsib "drive.appdata" luba. See on minimaalne luba ühe faili salvestamiseks Drive\'i. Me ei pääse ligi sinu teistele failidele.',
        'manual.add.title': 'Raamatute Lisamine',
        'manual.add.body': 'Klõpsa "Lisa" nuppu raamatute lisamiseks. Saad skaneerida triipkoodi, otsida nime/ISBN-i järgi (Google Books, OpenLibrary, Finna) või sisestada andmed käsitsi.',
        'manual.loans.title': 'Laenutused & Kalender',
        'manual.loans.body': 'Jälgi välja laenatud ("Laenatud Välja") või laenatud ("Laenatud") raamatuid. Määra kuupäev ja loo kalendrisündmus "Sündmus" lingi kaudu.',
        'manual.filters.title': 'Filtreerimine & Sortimine',
        'manual.filters.body': 'Kasuta ülemist riba raamatute leidmiseks. Filtreeri aasta, hinde või kuupäeva järgi. Sordi lisamise, aasta või hinde alusel.',
        'nav.manual': 'Kasutusjuhend',
        'btn.close': 'Sulge',
    }
};

// Default logic
const getBrowserLang = () => {
    const navLang = navigator.language.toLowerCase();
    if (navLang.startsWith('fi')) return 'fi';
    if (navLang.startsWith('et')) return 'et';
    return 'en';
};

let currentLang = localStorage.getItem('lang') || getBrowserLang();

export const t = (key) => {
    return translations[currentLang][key] || key;
};

export const setLang = (lang) => {
    if (translations[lang]) {
        currentLang = lang;
        localStorage.setItem('lang', lang);
        applyTranslations();
        document.dispatchEvent(new Event('language-changed'));
    }
};

export const applyTranslations = () => {
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        el.textContent = t(key);
    });

    document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        el.placeholder = t(key);
    });

    // Update selector UI if exists
    const selector = document.getElementById('lang-select');
    if (selector) selector.value = currentLang;
};

export const initI18n = () => {
    applyTranslations();

    // Wiring handled by init.js if selector exists, or we attach here
    const select = document.getElementById('lang-select');
    if (select) {
        select.value = currentLang;
        select.addEventListener('change', (e) => {
            setLang(e.target.value);
        });
    }
};
